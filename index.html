<!doctype html> 
<html lang="en"> 
<head> 
	<meta charset="UTF-8" />
	<title>Link Runner WIP</title>
    <script src="phaser.min.js"></script>
    <style type="text/css">
        body {
            margin: 0;
        }
    </style>
</head>
<body>

<script type="text/javascript">

var game = new Phaser.Game(800, 600, Phaser.AUTO, '', { preload: preload, create: create, update: update });

function preload() {

	game.load.tilemap('map', 'assets/opengameart/station-tilemap-test.json', null, Phaser.Tilemap.TILED_JSON);
	game.load.image('StationTileset', 'assets/opengameart/StationTileset.png');

	game.load.image('star', 'assets/phaser/star.png');
	game.load.spritesheet('astronaut', 'assets/opengameart/astronaut3_0.png', 29, 37);

	// from basic follow.js
	game.load.image('background','assets/phaser/tests/debug-grid-1920x1920.png');

}

var worldWidth = 5000;
var worldHeight = 1000;
var player;
var map;
var layer;
var cursors;
var stars;
var score = 0;
var scoreText;

function create() {

	// Enable the Arcade Physics system
	game.physics.startSystem(Phaser.Physics.ARCADE);

	// Add background
	game.add.tileSprite(0, 0, worldWidth, worldHeight, 'background');

	game.world.setBounds(0, 0, worldWidth, worldHeight);

	// Add tilemap
	map = game.add.tilemap('map');

	map.addTilesetImage('StationTileset');

	map.setCollisionBetween(1, 12);  // Station Tilemap tiles

	layer = map.createLayer('Platform Layer');
	layer.resizeWorld();
	layer.debugSettings.forceFullRedraw = true;

	// Create the player and its settings
	player = game.add.sprite(100, 100, 'astronaut');

	// Enable physics on the player
	game.physics.enable(player);

	// Player physics properties.
	player.body.allowGravity = false;
	player.body.collideWorldBounds = true;

	// Two animations, walking left and right
	player.animations.add('left', [1, 2], 10, true);
	player.animations.add('right', [2, 1], 10, true);

	// Some stars to collect
	stars = game.add.group();

	stars.enableBody = true;

	// Here we'll create 12 of them evenly spaced apart
	for (var i = 0; i < 20; i++)
	{
		// Create a star inside of the 'stars' group
		var star = stars.create((i + 1) * 100, 0, 'star');

		// Let gravity do its thing
		star.body.gravity.y = 100;

		// Give each star a slightly random bounce value
		star.body.bounce.y = 0.7 + Math.random() * 0.2;
	}

	// The score
	scoreText = game.add.text(16, 16, 'Score: 0', { fontSize: '32px', fill: '#000' });
	scoreText.fixedToCamera = true;
	scoreText.cameraOffset.setTo(16, 16);

	// Our controls
	cursors = game.input.keyboard.createCursorKeys();

	// Set the camera to follow the player
	game.camera.follow(player)

}

function update() {

	// Collide the player and the stars with the tilemap
	game.physics.arcade.collide(player, layer);
	game.physics.arcade.collide(stars, layer);

	// Check to see if the player overlaps with a star. If it does, collect the star.
	game.physics.arcade.overlap(player, stars, collectStar, null, this);

	// Reset the players velocity
	player.body.velocity.x = 0;

	// Make the sprite flip on center axis when switching directions.
	player.anchor.setTo(0.5, 1)

	if (cursors.left.isDown)
	{
		// Move to the left
		player.body.velocity.x = -150;

		player.scale.x = -1;

		player.animations.play('left');
	}
	else if (cursors.right.isDown)
	{
		// Move to the right
		player.body.velocity.x = 150;

		player.scale.x = 1;

		player.animations.play('right');
	}
	else
	{
		// Stand still
		player.animations.stop();

		player.frame = 0;
	}

	if (cursors.up.isDown)
	{
		player.body.velocity.y = -150;
	}
	else if (cursors.down.isDown)
	{
		player.body.velocity.y = 150;
	}
	else
	{
		player.body.velocity.y = 0
	}

}

function collectStar (player, star) {

	// Removes the star from the screen
	star.kill();

	// Add and update the score
	score += 10;
	scoreText.text = 'Score: ' + score;

}

</script>

</body>
</html>
